#!/usr/bin/env php
<?php
use Doctrine\Common\Annotations\AnnotationRegistry;
use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;

/**
 * Полный путь к корню сайта
 */
define('ERESUS_PATH', __DIR__ . '/..');

/** @var \Composer\Autoload\ClassLoader $loader */
/** @noinspection PhpIncludeInspection */
$loader = require ERESUS_PATH . '/vendor/autoload.php';

/* intl */
if (!function_exists('intl_get_error_code'))
{
    /** @noinspection PhpIncludeInspection */
    require_once ERESUS_PATH
        . '/vendor/symfony/symfony/src/Symfony/Component/Locale/Resources/stubs/functions.php';

    $loader->add(
        '',
        ERESUS_PATH . '/vendor/symfony/symfony/src/Symfony/Component/Locale/Resources/stubs'
    );
}

/** @noinspection PhpParamsInspection */
AnnotationRegistry::registerLoader(array($loader, 'loadClass'));

$loader->add('Eresus_', ERESUS_PATH . '/core');

$input = new ArgvInput();
$env = $input->getParameterOption(array('--env', '-e'), getenv('SYMFONY_ENV') ?: 'dev');
$debug =
    getenv('SYMFONY_DEBUG') !== '0'
        && !$input->hasParameterOption(array('--no-debug', ''))
        && $env !== 'prod';

/**
 * @global Eresus_Kernel $kernel
 */
$kernel = new Eresus_Kernel($env, $debug);

$kernel->loadClassCache();
$application = new Application($kernel);
$application->run($input);
