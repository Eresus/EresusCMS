Обработка запросов браузера
===========================

Все запросы от браузера (за некоторым исключением) перехватываются файлом ``index.php``, при этом создаётся экземпляр основного класса приложения — `Eresus_CMS <../../../api/Eresus/Eresus_CMS.html>`_. Этот класс выполняет инициализацию ядра CMS, а также запускает соответствующий запросу интерфейс --- клиентский или административный. Последовательность действий выглядит примерно так:

Инициализация CMS
-----------------

#. Проверка и подготовка окружения (наличие настроечных файлов, создание недостающих папок логов и кэша)
#. Чтение конфигурационных файлов
#. Запуск механизма сессий
#. Чтение и предварительная обработка запроса HTTP (заполняется массив `Eresus::$request <../../../api/Eresus/Eresus.html#$request>`_)


| Подготовка "ленивого" соединения с СУБД ||
| Создание экземпляра [[cms:dev:reference:php:eresus_model_site:index|]] ||
| Инициализация локали ||
| Инициализация сессии. Аутентификация по куки, если он есть ||
| Настройка шаблонизатора ||
| Активация соответствующего пользовательского интерфейса: ||
^  Клиентский интерфейс  ^  Административный интерфейс  |
| Создание экземпляра [[cms:dev:ref:class:tclientui:index|]] | |
| **Инициируется [[events|событие]] [[cms:dev:ref:events#clientOnStart|clientOnStart]]** | |
| Ищется запрошенный раздел сайта. Для него и каждого его родителя **генерируется событие [[cms:dev:ref:events#clientOnURLSplit|clientOnURLSplit]]** | |
| Начинается создание разметки страницы (отрисовка) | |
| Выбирается шаблон страницы | |
| **Вызывается метод [[cms:dev:ref:class:contentplugin:clientrendercontent|]] для получения от модуля расширения контента страницы** | |
| **Генерируется событие [[cms:dev:ref:events#clientOnContentRender|clientOnContentRender]]** | |
| Контент страницы подставляется в шаблон | |
| **Генерируется событие [[cms:dev:ref:events#clientOnPageRender|clientOnPageRender]]** | |
| Производятся подстановки в секцию ''<head>'' страницы (стили, скрипты, ...) | |
| Браузеру отправляются заголовки HTTP | |
| **Генерируется событие [[cms:dev:ref:events#clientBeforeSend|clientBeforeSend]]** | |
| Браузеру отправляется созданная страница | |

Жирным на схеме отмечены места, в которых управление передаётся модулям расширения, что позволяет им влиять на работу системы. Подробнее об этом будет рассказано в последующих разделах.

